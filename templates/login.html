<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Login • Nagonu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    :root{
      --glass-bg: rgba(255,255,255,.12);
      --glass-border: rgba(255,255,255,.25);
      --focus: #0ea5e9;
    }
    .bg-wrap{ position: fixed; inset: 0; overflow: hidden; z-index: -2; }
    .bg-wrap::before{
      content:""; position:absolute; inset:0;
      background: url("https://res.cloudinary.com/dcmewvlyx/image/upload/v1754393415/two_people_tewigi.webp") center/cover no-repeat;
      filter: blur(10px) brightness(.9); transform: scale(1.08);
    }
    .bg-dim{ position: fixed; inset: 0; background: radial-gradient(1200px 800px at 70% 20%, rgba(0,0,0,.25), rgba(0,0,0,.55)); z-index:-1; }

    .auth-card{
      backdrop-filter: blur(10px); background: var(--glass-bg); border: 1px solid var(--glass-border);
      border-radius: 18px; box-shadow: 0 10px 30px rgba(0,0,0,.25);
      animation: slideIn .7s cubic-bezier(.2,.7,.2,1) both;
    }
    @keyframes slideIn{ from{opacity:0; transform:translateY(14px) scale(.98);} to{opacity:1; transform:translateY(0) scale(1);} }
    @media (prefers-reduced-motion: reduce){ .auth-card{ animation: none; } }

    .brand{ display:flex; align-items:center; gap:.6rem; }
    .brand img{ width:42px; height:42px; border-radius:10px; object-fit:cover; border:2px solid #0ea5e9; background:#fff; }
    .brand .name{ font-weight:700; letter-spacing:.3px; color:#fff; }
    .brand .tag{ font-size:.85rem; color: rgba(255,255,255,.8); }

    .form-label{ color:#e9eef6; }
    .form-control{ background: rgba(255,255,255,.07); color:#fff; border:1px solid rgba(255,255,255,.25); }
    .form-control:focus{
      border-color: var(--focus); box-shadow: 0 0 0 .2rem rgba(14,165,233,.25);
      background: rgba(255,255,255,.12); color:#fff;
    }
    .input-group-text{ background: rgba(255,255,255,.08); color:#fff; border-color: rgba(255,255,255,.25); }
    .small-muted{ color: rgba(255,255,255,.75); }

    .btn-primary{ background:#0ea5e9; border-color:#0ea5e9; }
    .btn-primary:hover{ filter: brightness(.95); }

    .caps-hint{ display:none; color:#ffdf7e; }
    .caps-hint.show{ display:inline-flex; align-items:center; gap:.35rem; }

    .flash-wrap .alert{
      backdrop-filter: blur(6px); background: rgba(255,255,255,.15);
      border: 1px solid rgba(255,255,255,.3); color:#fff;
    }

    .auth-container{ min-height: 100dvh; display:grid; place-items:center; padding: clamp(16px, 3vw, 32px); }
    .auth-inner{ width: min(96vw, 420px); }
  </style>
</head>
<body>
  <!-- Background -->
  <div class="bg-wrap"></div>
  <div class="bg-dim"></div>

  <main class="auth-container">
    <div class="auth-inner">
      <!-- Brand -->
      <div class="d-flex justify-content-center mb-3">
        <div class="brand text-center">
          <img src="https://res.cloudinary.com/dcmewvlyx/image/upload/v1754392905/Ngonu_Logo_xntvbm.jpg" alt="Nagonu Logo">
          <div class="text-start">
            <div class="name">Nagonu</div>
           
          </div>
        </div>
      </div>

      <!-- Flash messages -->
      <div class="flash-wrap mb-3">
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="alert alert-{{ category }} mb-2 py-2 px-3" role="alert">
                {{ message }}
              </div>
            {% endfor %}
          {% endif %}
        {% endwith %}
      </div>

      <!-- Card -->
      <div class="auth-card p-4 p-md-4">
        <h1 class="h4 text-white mb-3 text-center">Login</h1>

        <form method="post" novalidate id="loginForm">
          <div class="mb-3">
            <label class="form-label" for="username">Username</label>
            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-person"></i></span>
              <input type="text" id="username" name="username" class="form-control" placeholder="Enter your username" required autocomplete="username">
            </div>
          </div>

          <div class="mb-2">
            <label class="form-label d-flex justify-content-between align-items-center" for="password">
              <span>Password</span>
              <small class="caps-hint" id="capsHint"><i class="bi bi-exclamation-triangle"></i> Caps Lock is ON</small>
            </label>
            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-lock"></i></span>
              <input type="password" id="password" name="password" class="form-control" placeholder="••••••••" required autocomplete="current-password">
              <button class="btn btn-outline-light" type="button" id="togglePw" aria-label="Show password">
                <i class="bi bi-eye"></i>
              </button>
            </div>
          </div>

          <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" value="1" id="remember" name="remember">
              <label class="form-check-label small-muted" for="remember">Remember me</label>
            </div>
            <!-- Fallback href works even without JS; JS enhances it with username -->
            <a
              id="forgotLink"
              class="small-muted text-decoration-none"
              target="_blank" rel="noopener"
              href="https://wa.me/233553226196?text={{ 'Hello Nagonu Support, I want to reset my admin password. Please assist.' | urlencode }}"
              >Forgot password?</a>
          </div>

          <button class="btn btn-primary w-100" type="submit" id="submitBtn">
            <span class="btn-text">Login</span>
            <span class="spinner-border spinner-border-sm ms-2 d-none" role="status" aria-hidden="true"></span>
          </button>
        </form>

        <div class="text-center mt-3 small-muted">
          Protected area. Unauthorized access prohibited.
        </div>
      </div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    (function(){
      const pw = document.getElementById('password');
      const toggle = document.getElementById('togglePw');
      const caps = document.getElementById('capsHint');
      const form = document.getElementById('loginForm');
      const btn = document.getElementById('submitBtn');
      const spinner = btn.querySelector('.spinner-border');
      const btnText = btn.querySelector('.btn-text');
      const forgot = document.getElementById('forgotLink');
      const usernameEl = document.getElementById('username');

      // Show/Hide password
      toggle?.addEventListener('click', () => {
        const isPwd = pw.type === 'password';
        pw.type = isPwd ? 'text' : 'password';
        toggle.innerHTML = isPwd ? '<i class="bi bi-eye-slash"></i>' : '<i class="bi bi-eye"></i>';
        toggle.setAttribute('aria-label', isPwd ? 'Hide password' : 'Show password');
        pw.focus();
      });

      // Caps Lock indicator
      function handleCaps(e){
        const on = e.getModifierState && e.getModifierState('CapsLock');
        caps.classList.toggle('show', !!on);
      }
      pw.addEventListener('keyup', handleCaps);
      pw.addEventListener('keydown', handleCaps);

      // Submit with loading state + basic constraint validation
      form.addEventListener('submit', function(e){
        if(!form.checkValidity()){
          e.preventDefault();
          e.stopPropagation();
          form.classList.add('was-validated');
          return;
        }
        btn.disabled = true;
        spinner.classList.remove('d-none');
        btnText.textContent = 'Signing in...';
      }, {passive:false});

      // Enhance "Forgot password?" → WhatsApp with username + context
      forgot?.addEventListener('click', function(e){
        // Build a richer message using the typed username
        const u = (usernameEl?.value || '').trim();
        const base = 'Hello Nagonu Support, I want to reset my admin password.';
        const more = u ? ' Username: ' + u + '.' : '';
        const tail = ' Please assist.';
        const msg = encodeURIComponent(base + more + tail);

        // Always route to your WhatsApp number
        const url = 'https://wa.me/233553226196?text=' + msg;

        // Replace href at click time (so middle-click works too)
        this.href = url;
        // let the default behavior open in a new tab (target=_blank)
      });
    })();
  </script>
</body>
</html>
